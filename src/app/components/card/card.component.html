<div class="w3-container w3-center w3-margin">

  <div class="promo-link w3-margin-bottom">
    <a routerLink="/game" class="w3-btn w3-black title-game" title="Play Guess the Club!">
      <i class="fas fa-gamepad"></i> Guess the Club Game
    </a>
    <a class="w3-btn w3-black title-game" (click)="openMatchesModal()" title="Today's Matches">
      <i class="fas fa-calendar-day"></i> View Today's Matches
    </a>
  </div>

  <div class="w3-container w3-center w3-margin-top">
    <p class="highlight-text modal-title">
      <span>+{{ animatedClubsCount }}</span> football clubs
    </p>
  </div>

  <div class="search-box">
    <i class="fa fa-search search-icon"></i>
    <input type="text" class="w3-input search-input" 
           placeholder="Search by club or city" [(ngModel)]="searchTerm">
    <i *ngIf="searchTerm" class="w3-center fa fa-times clear-icon" (click)="clearSearch()"></i>
  </div>
</div>

<div class="action-container w3-margin">

  <button class="filter-btn action-btn" (click)="openCountryModal()" title="Click to filter clubs by country">
    <i class="fa fa-filter w3-margin-right"></i> Filter
  </button>

  <button *ngIf="selectedCountry" 
          class="clear-btn action-btn" 
          (click)="clearCountryFilter()">
    <i class="fa fa-times w3-margin-right"></i> Clear
  </button>

  <button class="filter-btn action-btn" (click)="selectRandomClub()" title="Click to generate random club">
    <i class="fa fa-random w3-margin-right"></i> Random
  </button>

  <select [(ngModel)]="sortOption" class="filter-btn action-btn" title="Sort clubs">
    <option value="default"> Sort by</option>
    <option value="az">A–Z</option>
    <option value="za">Z–A</option>
  </select>

</div>

<div *ngIf="filteredClubs.length === 0" class="w3-container w3-center no-results">
  <p>No clubs found</p>
</div>

<!-- Modal Países -->
<div *ngIf="isCountryModalOpen" class="w3-modal" style="display:block;">
  <div class="w3-modal-content w3-animate-zoom" style="max-width:600px; margin:auto;">
    <header class="w3-container w3-center w3-black title-game">
      <span (click)="closeCountryModal()" class="w3-button w3-display-topright w3-black title-game">
        <i class="fa fa-times"></i>
      </span>  
      <h5>Select a Country</h5>
    </header>

    <div class="w3-container w3-padding">
      <input type="text" class="w3-input w3-margin-bottom" placeholder="Search country..." [(ngModel)]="countrySearch">

      <ul class="w3-ul w3-hoverable" style="max-height:300px; overflow-y:auto;">
        <li *ngFor="let country of filteredCountries()" 
            (click)="selectCountry(country)"
            [ngClass]="{'w3-light-grey': selectedCountry === country}"
            class="w3-padding w3-hover-light-grey">
            <span class="w3-margin-right fi" [ngClass]="'fi-' + getCountryCode(country)"></span>
          {{ country }}
        </li>
      </ul>
    </div>
  </div>
</div>

<div class="responsive-grid w3-padding-16">
  <div class="w3-card-2 w3-hover-shadow card" *ngFor="let club of filteredClubs; let i = index" (click)="openModal(i)">
    <img src="{{club.club_logo}}" alt="{{club.club_name}}" class="w3-image img w3-hover-opacity-off" loading="lazy">
    <span class="zoom-icon" (click)="openImageModal(club, $event)">
      <i class="fa fa-search-plus"></i>
    </span>
    <footer class="w3-container w3-center">
      <p>{{club.club_name}}</p>
    </footer>
  </div>
</div>

<div *ngIf="selectedImage" class="w3-modal" style="display:block;">
  <div class="w3-modal-content w3-animate-zoom" style="max-width:500px; margin:auto; text-align:center;">
    
    <lib-ngx-image-zoom
      [thumbImage]="selectedImage"
      [fullImage]="selectedImage"
      [magnification]="2"
      [enableScrollZoom]="true"
      [enableLens]="true"
      [lensWidth]="120"
      [lensHeight]="120"
      [zoomMode]="'hover'"
      style="display:block; margin:auto; max-width:80%;"
    ></lib-ngx-image-zoom>

    <div style="margin-top:10px;">
      <button (click)="closeImageModal()" class="w3-button w3-black title-game" style="width: 100%;">
        <i class="fa fa-times"></i>
      </button>
    </div>
    
  </div>
</div>


<!-- Load More -->
<div class="w3-center w3-padding" *ngIf="filteredClubs.length < totalFilteredCount">
  <button (click)="loadMore()" class="w3-btn w3-black w3-margin-top title-game" *ngIf="!searchTerm || selectedCountry">
    Load More
  </button>
</div>

<!-- Modal Club -->
<div *ngIf="selectedClub" id="clubModal" class="w3-modal" style="display:block;">
  <div class="w3-modal-content w3-animate-zoom" style="max-width:600px; margin:auto;">
    <header class="w3-container w3-center">
      <span (click)="closeModal()" class="w3-button w3-display-topright w3-black title-game">
        <i class="fa fa-times"></i>
      </span>  
    </header>

    <div class="w3-center w3-margin-top">
      <span class="fi club-flag" [ngClass]="'fi-' + getCountryCode(selectedClub.city_country)"></span>
    </div>

    <div class="w3-container w3-center">
      <h2 class="modal-title">{{ selectedClub.club_name }}</h2>
      <p><strong>Location:</strong> {{ selectedClub.city_country }}</p>
      <p><strong>More Info:</strong></p>
      <div class="w3-center w3-margin-bottom">
        <a [href]="selectedClub.wiki_url" target="_blank" class="w3-btn w3-black w3-medium w3-border w3-margin-right" title="View Wikipedia">
          <i class="fa-brands fa-wikipedia-w fa-lg icon"></i>
        </a>
        <a [href]="getGoogleNewsUrl(selectedClub)" target="_blank" class="w3-btn w3-black w3-medium w3-border" title="Search on Google">
          <i class="fa-brands fa-google fa-lg icon"></i>
        </a>
        <a [href]="getYouTubeUrl(selectedClub)" target="_blank" class="w3-btn w3-black w3-medium w3-border w3-margin-left" title="Search on YouTube">
          <i class="fa-brands fa-youtube fa-lg icon"></i>
        </a>
      </div>
    </div>

    <div class="w3-center w3-margin-top">
      <p>Share this club (via X):</p>
      <a [href]="getTwitterShareUrl(selectedClub)" target="_blank" class="w3-btn w3-black" title="Share on X">
        <i class="fa-brands fa-x-twitter fa-lg icon"></i>    
      </a>
    </div>    

    <footer class="w3-container w3-padding">
      <button (click)="closeModal()" class="w3-btn w3-black w3-margin-bottom title-game">Close</button>
    </footer>
  </div>
</div>

<div *ngIf="isMatchesModalOpen" class="w3-modal" style="display:block;">
  <div class="w3-modal-content w3-animate-zoom w3-card-4" style="max-width:800px; margin:auto;">
    
    <header class="w3-container w3-black w3-center title-game">
      <span (click)="closeMatchesModal()" class="w3-button w3-display-topright w3-black title-game">
        <i class="fa fa-times"></i>
      </span>
      <h4>Matches Today</h4>
    </header>

    <div class="w3-container w3-padding w3-light-grey" style="max-height:400px; overflow-y:auto;">
      <div *ngIf="!loadingMatches && matches.length === 0" class="w3-center w3-small w3-text-gray">
        No matches scheduled today.
      </div>
<ul *ngIf="matches.length > 0" class="w3-ul w3-white w3-hoverable w3-small">
  <li *ngFor="let match of matches" class="w3-padding-small w3-border-bottom">
    <div class="w3-row w3-center w3-padding-small">

      <!-- Equipo Local -->
      <div class="w3-col s4 m4 l4 w3-left-align w3-small">
        <img *ngIf="match.homeTeam.crest" [src]="match.homeTeam.crest" class="w3-circle" style="width:25px; height:25px; object-fit:contain;" [title]="match.homeTeam.name">
        {{ match.homeTeam.name }}
      </div>

      <!-- Marcador -->
      <div class="w3-col s4 m4 l4 w3-center">
        <strong *ngIf="match.score.fullTime.home !== null">
          {{ match.score.fullTime.home }} - {{ match.score.fullTime.away }}
        </strong>
        <span *ngIf="match.score.fullTime.home === null" class="w3-text-gray">vs</span>
      </div>

      <!-- Equipo Visitante -->
      <div class="w3-col s4 m4 l4 w3-right-align w3-small">
        {{ match.awayTeam.name }}
        <img *ngIf="match.awayTeam.crest" [src]="match.awayTeam.crest" class="w3-circle" style="width:25px; height:25px; object-fit:contain;" [title]="match.awayTeam.name">
      </div>

      <!-- Competición y estado al final -->
      <div class="w3-col s12 w3-center w3-small w3-text-gray w3-margin-top">
        {{ match.competition.name }} • {{ match.status }}
      </div>

    </div>
  </li>
</ul>

    </div>

  </div>
</div>


<button 
  class="back-to-top" 
  [ngClass]="{'fade-out': isFadingOut}"
  *ngIf="showBackToTop || isFadingOut" 
  (click)="scrollToTop()" 
  title="Back to Top">
  <i class="fa fa-arrow-up"></i>
</button>
